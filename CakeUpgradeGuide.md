### Введение ###
В связи с возникающими вопросами о том, как обновить биллинг до версии 1.0.1, поясню необходимые для этого действия.

### Сохранение текущей базы данных ###
Прежде чем осуществлять какие либо действия с базой сохраните ее при помощи команды:
```
pg_dump -Ucake -d cake -f cake.backup.sql
```
Если выполнение команды завершилась успешно то далее можно производить обновление.

**Note:**
Команда выполняется с локальной консоли сервера с СУБД. Если вы выполняете ее с удаленной консоли сначала ознакомтесь с документацией по работе с утилитой **pg\_dump**.


### Обновление базы данных ###
Перед обновлением базы данных Cake выключите сервисы **pptpd radiusd** и **resin**:
```
cd /etc/init.d
./pptpd stop
./radiusd stop
./resin stop
```

Это небходимо для того, чтобы во время обновления не происходило никаких обращений к БД. На производимые обновления это может не повлиять, а на работоспособность биллинга во время выполнения операции обновления может.

**Note:**
Команды приведены для Gentoo Linux. Если у вас используется другой дистрибутив или операционная система то ознакомтесь с документацией для выполнения аналогичных действий.

Далее скачайте [скрипт](http://cakebilling.googlecode.com/files/cake-upgrade-v1.0-v1.0.1.rc.sql):
```
wget -c http://cakebilling.googlecode.com/files/cake-upgrade-v1.0-v1.0.1.rc.sql
```

Затем запустите следующую команду:
```
psql -Ucake cake < cake-upgrade-v1.0-v1.0.1.rc.sql
```

Если в результате обновления не произошло никаких ошибок, то обновление базы данных прошло успешно. Перейдем к модификации конфигурации FreeRADIUS сервера.

### Изменение конфигурации FreeRADIUS сервера ###
С изменениями в конфигурации FreeRADIUS сервера вы можете ознакомиться [тут](ChangeLog.md). Модификация необходима из-за добавления функции автоматической очистки таблицы keepalive. По умолчанию удаляются записи старше 30 дней. Изменить этот параметр можно в разделе **"Настройки"**. Для модификации настройки FreeRADIUS сервера скачайте измененный файл конфигурации:

```
wget -c http://cakebilling.googlecode.com/files/cakesql.conf
```

Затем замените старый файл **cakesql.conf** на новый:
```
cp cakesql.conf /etc/raddb/cakesql.conf
```

Если при выполнении описанных операций не возникло ошибок, то изменение конфигурации FreeRADIUS сервера завершилось успешно. Перейдем к обновлению web-интерфейса.

### Обновление web-интерфейса ###
Сначала необходимо скачать новую версию web-интерфейса:

```
wget -c http://cakebilling.googlecode.com/files/cake-1.0.1rc.war
```

Сохраните настройки веб-интерфейса:
```
cp /opt/resin/webapps/cake/WEB-INF/cake.xml cake.xml
```

Удалите старую версию web-интерфейса:
```
rm -r /opt/resin/webapps/cake
rm /opt/resin/webapps/cake.war
```

Распакуйте новую версию web-интерфейса:
```
unzip cake.war -d /opt/resin/webapps/cake
```

Скопируйте настройки веб-интерфейса обратно:
```
cp cake.xml /opt/resin/webapps/cake/WEB-INF/cake.xml
```

Далее смените владельца каталога:
```
chown -R resin:resin /opt/resin/webapps/cake
```

Если при выполнении операций не возникло ошибок, то обновление web-интерфейса прошло успешно. Переходим к запуску сервисов.

### Запуск сервисов ###
Теперь необходимо запустить сервисы:
```
cd /etc/init.d
./resin start
./radiusd start
./pptpd start
```

Если запуск был успешен, то проверьте работоспособность биллинга. Он должен функционировать в штатном режиме.
Процедуры по обновлению биллинга звершены.