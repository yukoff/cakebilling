#summary Вопросы и ответы
#labels Featured

===Вопросы по работе с БД===

====Почему Cake поддерживает только PostgreSQL? Почему нет MySQL?====
Расчётная часть и бизнес логика Cake основаны на использовании хранимых процедур. MySQL версии 4.x поддерживает только SQL89, а в его спецификации нет хранимых процедур.
Поддержка хранимых процедур появилась только в MySQL 5.x. Если вам необходим MySQL, то воспользуйтесь [http://nibs.net.ua/ FreeNIBS] или портируйте схему данных в MySQL 5.x.

====Под какие СУБД можно портировать Cake?====
Под любую СУБД, которая поддерживается модулем FreeRADIUS *rlm_sql* и поддерживает хранимые процедуры.
Модуль *rlm_sql* FreeRADIUS сервера поддерживает следующие базы данных:
  * IBM DB2
  * MySQL (5.х)
  * PostgreSQL
  * Oracle
  * Sybase
Кроме этого *rlm_sql* модуль поддерживает следующие ODBC мосты:
  * iODBC
  * UnixODBC

====Cake после полугода работы стал работать медленно, в чем дело?====
Дело в том, что база растет. Необходимо выполнять профилактику базы хотя бы раз в неделю. Для этого запустите psql:
{{{
psql -Ucake cake
}}}
И в консоли выполните команду:
{{{
VACUUM FULL ANALYZE;
}}}

Перед выполнением этой команды желательно выключить все сервисы биллинга кроме *postgresql*, так как данная команда полностью блокирует базу данных. Кроме этого можно использовать *pg-autovacuum*. Начиная с 8.x версий PostgreSQL он входит в стандартную поставку. Если же это не помогло, проверьте количество записей в таблице *keepalive*, возможно их там уже очень много. В этом случае советую [CakeUpgradeGuide обновиться до версии 1.0.1] -- там есть механизм автоматического удаления устаревших данных. Учтите что даже при использовании этого механизма все равно необходимо выполнять команду VACUUM.

===Вопросы по работе с сетью===

====У пользователей часто возникает ошибка error 737: Loopback was detected что делать?====
В файл **options.pptpd** добавьте опцию **nologfd**.

====Я использую Windows 9x/Me и у меня не проходит авторизация. В чем может быть дело?====
Дело в том что *Windows 9x/Me* при авторизации в VPN добавляет _ИмяДомена\\_ или если она не входит в домен то _\\_.
FreeRADIUS позволяет отсечь ненужные символы. Для этого в *radiusd.conf* (секция *preprocess*) опцию *with_ntdomain_hack*:
{{{
preprocess {
        # huntgroups - хинт группы см. файл huntgoups.
        # hints - хинты.
        huntgroups = ${confdir}/huntgroups
        hints = ${confdir}/hints

        with_ntdomain_hack = yes

        # Обработка Cisco VSA.
        with_cisco_vsa_hack = no
}
}}}

====Пользователи жалуются на то, что после подсоединения к интернету медленно открывается сетевое окружение.====
Это вызвано тем, что Windows пытается обслуживать SMB протокол на VPN интерфейсе. Для устранения этого явления следует зайти на вкладку "Сеть" свойств VPN подключения и убрать галочки у "Cлужбы доступа к файлам и принтерам" и "Клиент для сетей Microsoft".

===Технологические вопросы===

====У меня повисла сессия пользователя. Что делать?====
Подождать 2 минуты начиная с последнего обновления сессии. Далее просто подключиться любым пользователем по VPN к биллингу. Перед аутентификацией пользователя выполняется сброс зависших сессий.

====В Cake нет детализации трафика, что можно сделать?====
Первый способ -- установить прокси-сервер squid в *прозрачном режиме*, в этом случае посещения клиентов будут отражены в *access.log* прокси сервера.
Второй способ -- установить коллектор *netflow* и агрегатор *netflow*.

====Можно ли в Cake назначить ip-адрес пользователю вручную?====
Нет. При заведении пользователя ему автоматически выдается свободный адрес из пула ip адресов.

====Можно ли в Cake назначать реальные ip-адреса клиентам?====
Можно, но только пользователям всей сети. Выдать ip-адрес только некоторым пользователям невозможно.

====Почему в статистике если сессия начинается в один день, а заканчивается в другом, то статистика отображается неправильно?====
Такова особенность реализации, для экономии машинных ресурсов (представьте себе объемы выборки при по минутной детализации трафика за месяц) комплексный и месячный отчеты по трафику строятся на основании показаний сессии, а вхождение момента расхода трафика считается по моменту начала сессии. На основании показаний keepalive строится почасовой расход, в пределах одних суток.

====Обязательно ли писать в keepalive diff_in diff_out если они равны нулю?====
Да, так как эта функция обеспечивает равномерность ведения трафика.

====Почему Cake использует pptpd+pppd?====
*pppd* включает в себя radius плагин. Это позволяет использовать *RADIUS*-протокол для взаимодействия с *pppd*. *pptpd* является менеджером VPN соединений, и может быть заменен любым другим менеджером умеющим работать с *pppd*, к примеру *mgetty* или *rp-pppoe* сервером.

===Вопросы по веб-интерфейсу===
====Можно ли использвать www-сервер apache вместо сервера контейнера jsp и servlets?=====
Нет. Хотя существует *mod_jserv*, но на данный момент он не поддерживается. Если вам хочется привязать веб-интерфейс к уже существующему серверу - наиболее правильным выходом будет воспользоваться *mod_caucho* (resin) или *mod_jk* (tomcat).

===Где будет работать Cake?===
====Можно ли установить Cake под FreeBSD/NetBSD/OpenBSD?====
Да можно, для этого необходимо установить GNU pppd вместо оригинального. Так же можно воспользоваться mpd, но при этом у вас не будет возможности ограничивать пользователей по трафику, также кроме mpd можно воспользоваться exppp.

====Можно ли установить Cake под Windows?====
Теоретически возможно. RAS Windows поддерживает RADIUS протокол. FreeRADIUS и PostgreSQL можно установить под Windows, но у вас не будет возможности ограничивать пользователей по трафику.


*Note:*

Невозможно откидывать пользователя по перерасходу трафика в рамках установленного соединения. Но после разрыва соединения на счету пользователя будет отрицательный баланс и при следующей попытке система просто не пустит его, так что косвенно функции ограничения доступа к ресурсу все таки остаются.
